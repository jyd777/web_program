<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Blog Upload</title>
  <!-- Ant Design CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/antd/4.16.8/antd.min.css" integrity="sha512-8+K0a4chENL2ZXXCmJJ3zZgtFVn5+0YyfRm0dgd11aY5UyvMbgmwxS8jK6pQ4ry9wVKzHs6TVNm6Yx4u0XvJPg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <!-- WangEditor CSS -->
  <link rel="stylesheet" href="https://unpkg.com/@wangeditor/editor-for-react/dist/css/style.css">
  <link rel="stylesheet" href="../static/upload.css">
</head>
<body>
  <div class="header">
    <h2 class="logo">WordTongji</h2>
    <button class="search-button">首页</button>
    <button class="search-button">帮助</button>
    <div class="search-container">
      <input type="text" class="search-box magnifying-glass" placeholder="  请输入搜索内容">
    </div>
    <div style="float: right; margin-top: -50px; margin-right: 20px;">
      <img id="curimage" src="../static/user.jpg" alt="img" class="user-avatar">
  </div>
  </div>
  <div class="background-container">  
    <div class="content-container">
      <div class="editor-container">  
        <div>  
          <h2 class="post-title">帖子发布</h2>  
        </div>  
        <div class="editor-section">
            <label for="title" class="input-label">标题</label>
            <input id="title" class="editor-input" />
        </div>
        <div class="editor-section">
            <label for="fileContent" class="input-label">内容</label>
            <textarea id="fileContent" class="file-content"></textarea>
        </div>
        <div style="display: flex; align-items: center;">
          <button id="uploadButton" class="upload-button" type="button" onclick="uploadArticle()">
              发布
          </button>
          <label for="fileUpload" class="upload-image-button">
            <input type="file" id="fileUpload" style="display: none;" onchange="uploadImage(event)">
            <i class="fa-regular fa-image"  style="font-size: 24px; vertical-align: middle;margin-right:5px"></i>
            上传图片
        </label>
        <img id="uploadedImage" src="#" alt="Uploaded Image" style="display: none;">
      </div>
      </div>  
    </div>  
  </div>
  <script>
    document.getElementById('uploadedImage').addEventListener('click', function() {
    var enlargedImage = document.createElement('img');
    enlargedImage.src = this.src;
    enlargedImage.classList.add('enlarged-image');

    var modal = document.createElement('div');
    modal.classList.add('modal');
    modal.appendChild(enlargedImage);

    modal.addEventListener('click', function() {
        modal.remove();
    });

    document.body.appendChild(modal);
  });

  // 获取标题和内容输入框元素
  const titleInput = document.getElementById('title');
  const contentTextarea = document.getElementById('fileContent');
  const editorContainer = document.querySelector('.editor-container');

  // 监听标题输入框的点击事件
  titleInput.addEventListener('click', function() {
      editorContainer.classList.add('show-background');
  });

  // 监听内容输入框的点击事件
  contentTextarea.addEventListener('click', function() {
      editorContainer.classList.add('show-background');
  });

  // 监听鼠标移开事件
  editorContainer.addEventListener('mouseleave', function() {
      editorContainer.classList.remove('show-background');
  });

  // 发布文章函数
  function uploadArticle() {
    const title = document.getElementById('title').value;
    const content = document.getElementById('fileContent').value; // 获取内容

    // 检查标题和内容是否为空
    if (title && content) {
      // 发送POST请求到后端
      fetch('/upload_blog', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify([title, content]) // 发送标题和内容
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          alert('上传成功');
          // 清空标题和内容输入框
          document.getElementById('title').value = '';
          document.getElementById('fileContent').value = '';
        } else {
          alert('上传失败');
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert('上传失败');
      });
    } else {
      alert('请填写标题和内容');
    }
  }

  function uploadImage(event) {
    var file = event.target.files[0];
    var imageType = /image.*/;

    if (file.type.match(imageType)) {
        var reader = new FileReader();
        reader.onload = function(e) {
            var img = document.getElementById('uploadedImage');
            img.src = e.target.result;
            img.style.display = 'inline';
        };
        reader.readAsDataURL(file);
    } else {
        alert('请上传正确格式的图片文件');
    }
  }
  </script>
  <!-- WangEditor JS -->
  <script src="https://unpkg.com/@wangeditor/editor-for-react/dist/js/lib/wangEditor.min.js"></script>
</body>
</html>
